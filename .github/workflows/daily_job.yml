name: Daily VOC Crawler & Slack Sender

on:
  schedule:
    # ë§¤ì¼ í•œêµ­ ì‹œê°„ ì˜¤ì „ 9ì‹œ (UTC 0ì‹œ) ì‹¤í–‰
    - cron: '0 0 * * *'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼ (í…ŒìŠ¤íŠ¸ìš©)

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: ì €ì¥ì†Œ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
      uses: actions/checkout@v3

    - name: íŒŒì´ì¬ ì„¤ì¹˜
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
      run: |
        pip install pandas selenium webdriver-manager requests

    - name: 1. í¬ë¡¤ëŸ¬ ì‹¤í–‰ (ë°ì´í„° ìˆ˜ì§‘)
      run: python crawler.py

    - name: 2. ìŠ¬ë™ ì „ì†¡ ì‹¤í–‰
      env:
        # GitHub ê¸ˆê³ (Secrets)ì— ë„£ì–´ë‘” ì£¼ì†Œë¥¼ ê°€ì ¸ì™€ì„œ ì½”ë“œì— ì£¼ì…
        SLACK_WEBHOOK_URLS: ${{ secrets.SLACK_WEBHOOK_URLS }}
      run: python slack_sender.py

    - name: 3. ê²°ê³¼ ì €ì¥ (CSV íŒŒì¼ ì—…ë°ì´íŠ¸)
      run: |
        git config --global user.name "GitHub Action Bot"
        git config --global user.email "actions@github.com"
        git add electlink_voc.csv
        # ë³€ê²½ì‚¬í•­ì´ ìˆì„ ë•Œë§Œ ì»¤ë°‹ (ì—ëŸ¬ ë°©ì§€)
        git commit -m "ğŸ¤– Daily Data Update: $(date +'%Y-%m-%d')" || echo "ë³€ê²½ì‚¬í•­ ì—†ìŒ"
        git push